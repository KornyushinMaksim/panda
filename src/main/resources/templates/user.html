<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" type="text/css" media="all" href="/static/style.css" th:href="@{/style.css}" />
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="headerInner">
                <a href="/">
                    <div class="logo">
                        <img src="/images/logo_panda.jpeg">
                    </div>
                </a>
                <div class="headerMenu">
                    <div>
                        <a href="../fileStorage">Заявки</a>
                    </div>
                    <div>
                        <a href="../contacts">Проектная команда</a>
                    </div>
                    <div>Клиенты</div>
                    <div>Мои заявки</div>
                </div>
                <div class="search-profile">
                    <div class="headerSearch">
                        <input type="text" placeholder="Искать">
                        <button class="search">Поиск</button>
                    </div>
                    <div class="headerProfile">
                        <select name="" id="">
                            <option value="profile">Профиль</option>
                            <option value="login">Войти</option>
                            <option value="">3</option>
                            <option value="exit">Выйти</option>
                        </select>
                        <img src="/images/logo_profile.png">
                    </div>

                </div>

            </div>
        </div>

        <!-- Body -->
        <div class="containerBody">
            <div class="table">
                <table>
                    <thead>
                        <tr>
                            <th width="10%">№</th>
                            <th width="auto">Имя</th>
                            <th width="15%">Заказчик</th>
                            <!-- <th width="10%">Исполнитель</th> -->
                            <th width="10%">Дата</th>
                            <!-- <th width="15%">Автор</th> -->
                        </tr>
                    </thead>
                    <tbody id="tasksTableBody">

                    </tbody>
                    <!--                <tbody th:each="el : ${fileStorage}">-->
                    <!--                <tr>-->
                    <!--                    <td th:text="${el.id}"></td>-->
                    <!--                    <td>-->
                    <!--                        <a th:href="'propertiesFile/' + ${el.id}">-->
                    <!--                            <div th:text="${el.name}"></div>-->
                    <!--                        </a>-->
                    <!--                    </td>-->
                    <!--                    <td th:text="${el.typeFile}"></td>-->
                    <!--                    <td th:text="${el.date}"></td>-->
                    <!--                    <td th:text="${el.size}"></td>-->
                    <!--                    <td>-->
                    <!--                        <a th:href="profileStuff" th:text="${el.author}"></a>-->
                    <!--                    </td>-->
                    <!--                    <td th:text="${el.info}"></td>-->
                    <!--                </tr>-->
                    <!--                </tbody>-->
                </table>
                <button onclick="toggleVisibility()">Добавить</button>
                <button onclick="toggleVisibility1()">открыть</button>


            </div>

            <div id="docAdd" style="display: none;">
                <h3>Создание заявки</h3>
                <div class="containerDocAdd">
                    <form id="taskForm" action="/tasks/add-task" method="post">
                        <div class="form-group">
                            <label for="taskName">Название задачи:</label>
                            <input type="text" id="taskName" name="taskName">
                        </div>
                        <div class="form-group">
                            <label for="customer">Заказчик:</label>
                            <input type="text" id="customer" name="customer">
                        </div>
                        <div class="form-group">
                            <label for="executor">Исполнитель:</label>
                            <input type="text" id="executor" name="executor">
                        </div>
                        <div class="form-group">
                            <label for="fileList">Выберите файл:</label>
                            <select id="fileList" name="fileList"></select>
                        </div>
                        <button type="submit" onclick="toggleVisibility()">Создать задачу</button>
                        <button type="submit" onclick="toggleVisibility()">Отменить создание</button>
                    </form>

                    <script>
                        // Загрузка списка файлов с сервера
                        window.onload = function () {
                            fetch('http://localhost:8080/files/all-files')
                                .then(response => response.json())
                                .then(data => {
                                    const fileList = document.getElementById('fileList');
                                    data.forEach(file => {
                                        const option = document.createElement('option');
                                        option.value = file.id; // Здесь предполагается, что у файла есть уникальный идентификатор
                                        option.textContent = file.nameFile; // Предположим, что у файла есть поле "name"
                                        fileList.appendChild(option);
                                    });
                                })
                                .catch(error => console.error('Ошибка при загрузке списка файлов:', error));
                        };

                        // JavaScript для обработки отправки формы
                        document.getElementById('taskForm').addEventListener('submit', function (event) {
                            event.preventDefault(); // Предотвращаем отправку формы по умолчанию

                            // Дополнительная логика обработки данных формы, если нужно

                            // Пример вывода данных в консоль
                            console.log({
                                nameTask: this.taskName.value,
                                customer: this.customer.value,
                                executor: this.executor.value,
                                fileId: this.fileList.value,
                            });
                            // JavaScript для обработки отправки формы
                            document.getElementById('taskForm').addEventListener('submit', function (event) {
                                event.preventDefault(); // Предотвращаем отправку формы по умолчанию

                                // Собираем данные формы в объект FormData
                                const formData = new FormData();
                                formData.append('nameTask', this.taskName.value);
                                formData.append('customer', this.customer.value);
                                formData.append('executor', this.executor.value);
                                formData.append('fileId', this.fileList.value);

                                // Отправляем POST-запрос на сервер
                                fetch('http://localhost:8080/tasks/add-task', {
                                    method: 'POST',
                                    body: formData
                                })
                                    .then(response => {
                                        if (!response.ok) {
                                            throw new Error('Ошибка HTTP ' + response.status);
                                        }
                                        return response.json();
                                    })
                                    .then(data => {
                                        console.log('Задача успешно создана:', data);
                                        // Опционально: добавить здесь логику для обработки успешного создания задачи
                                    })
                                    .catch(error => {
                                        console.error('Ошибка при создании задачи:', error);
                                        // Опционально: добавить здесь логику для обработки ошибок при создании задачи
                                    });

                                // Опционально: очистка формы после отправки
                                this.reset();
                            });
                        });
                    </script>
                </div>
                <!-- <h3>Добавление файла</h3>
            <div class="containerDocAdd">
                <form action="/user" th:action="@{/files/add-file}" method="post">
                                       <!-- <input type="file" name="name" placeholder="Название"><br> -->
                <!-- <input type="text" name="nameFile" placeholder="Название и формат файла"><br> -->
                <!--                    <textarea name="info" cols="30" rows="10" placeholder="Описание"></textarea>-->
                <!-- <div class="bottons">
                        <button onclick="toggleVisibility()" type="submit" name="select" value="add">Добавить</button>
                        <button onclick="toggleVisibility()" type="submit" name="select" value="close">Закрыть</button>
                    </div>
                </form>
            </div> -->
            </div>
        </div>
    </div>

    <script th:src="@{/script.js}"></script>

</body>

</html>